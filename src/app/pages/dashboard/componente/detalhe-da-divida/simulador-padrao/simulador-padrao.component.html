<ng-template #modalTemplate let-modal>
  <div class="modal-header modal-header-custom" style="background: #3e4988; margin: 0">
    <h6 class="modal-title" style="color: #ffffff"><i class="fas fa-calculator" style="margin-right: 5px;"></i>
      Simulação de Negociação</h6>
    <button type="button" class="btn-close btn-close-white btn-close-small" aria-label="Close"
      (click)="modal.dismiss()"></button>
  </div>
  <div class="modal-body" style="padding-top: 2px; padding-bottom: 2px;">
    <form [formGroup]="form" (ngSubmit)="recalcular()">
      <div class="row mt-2">
        <div class="col-md-12">
          <div class="row align-items-center">
            <div class="col-md-2" style="font-size: 12px;">
              <small>Principal: {{ (originalPrincipal / 100) | percent:'1.0-0' }}</small>
              <input type="number" class="form-control form-control-sm" formControlName="desconto_principal" min="0"
                [max]="originalPrincipal" (input)="validarDesconto($event, 'Principal')">
            </div>
            <div class="col-md-2" style="font-size: 12px;">
              <small>Multa: {{ (originalMulta / 100) | percent:'1.0-0' }}</small>
              <input type="number" class="form-control form-control-sm" formControlName="desconto_multa" min="0"
                [max]="originalMulta" (input)="validarDesconto($event, 'Multa')">
            </div>
            <div class="col-md-2" style="font-size: 12px;">
              <small>Juros: {{ (originalJuros / 100) | percent:'1.0-0' }}</small>
              <input type="number" class="form-control form-control-sm" formControlName="desconto_juros" min="0"
                [max]="originalJuros" (input)="validarDesconto($event, 'Juros')">
            </div>
            <div class="col-md-2" style="font-size: 12px;">
              <small>Taxa: {{ (originalTaxa / 100) | percent:'1.0-0' }}</small>
              <input type="number" class="form-control form-control-sm" formControlName="desconto_taxa" min="0"
                [max]="originalTaxa" (input)="validarDesconto($event, 'Taxa')">
            </div>
            <div class="col-md-4" style="font-size: 12px;">
              <small>Data Negociação</small>
              <input type="date" class="form-control form-control-sm" id="dataNova" formControlName="data_atualizacao">
            </div>
          </div>
          <div class="col-md-12 d-flex justify-content-end button-group" style="font-size: 12px; margin-top: 5px;">
            <button type="submit" class="btn btn-primary btn-sm me-1" style="padding-bottom: 2px; padding-top: 2px;">
              <i class="fas fa-redo-alt"></i> Recalcular
            </button>
            <button type="submit" class="btn btn-secondary btn-sm" style="padding-bottom: 2px; padding-top: 2px;" (click)="habilitaBotao()">
              <i class="fas fa-handshake"></i> Acordo
            </button>
          </div>
        </div>
      </div>
      <div style="overflow: auto; height: 300px; margin-top: 5px;">
        <table class="table table-sm">
          <thead class="tabela-custom table-td-scroll">
            <tr>
              <th>Vencimento</th>
              <th>Atraso</th>
              <th>Desc Principal</th>
              <th scope="col" class="text-right">Desc Juros</th>
              <th scope="col" class="text-right">Desc Multa</th>
              <th>Desc Taxa</th>
              <th scope="col" class="text-right">Valor Atualizado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let titulo of data.titulos">
              <td>{{ dataBrasil(titulo.vencimento) }}</td>
              <td>{{ titulo.atraso }}</td>
              <td scope="col" class="text-right">{{ titulo.valor | currency:'BRL' }}</td>
              <td scope="col" class="text-right">{{ titulo.valor_juros | currency:'BRL' }}</td>
              <td scope="col" class="text-right">{{ titulo.valor_multa | currency:'BRL' }}</td>
              <td scope="col" class="text-right">{{ titulo.valor_taxa | currency:'BRL' }}</td>
              <td scope="col" class="text-right">{{ titulo.valor_atualizado | currency:'BRL' }}</td>
            </tr>
            <tr *ngIf="data.titulos.length > 0" class="tabela-custom">
              <td colspan="2" style="text-align: center;"><strong>Total:</strong></td>
              <td scope="col" class="text-right">{{ totalValor | currency:'BRL' }}</td>
              <td scope="col" class="text-right">{{ totalJuros | currency:'BRL' }}</td>
              <td scope="col" class="text-right">{{ totalMulta | currency:'BRL' }}</td>
              <td scope="col" class="text-right">{{ totalTaxa | currency:'BRL' }}</td>
              <td scope="col" class="text-right">{{ totalGeral | currency:'BRL' }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- Campo oculto para IDs dos títulos -->
      <input type="hidden" formControlName="titulos">
      <hr style="margin-top: 5px; margin-bottom: 5px;">
      <div class="col-md-12 d-flex justify-content-end button-group" style="font-size: 12px; margin-top: 5px; margin-left: 0px !important;">
        <button type="button" class="btn btn-success btn-sm me-1" style="padding-bottom: 2px;padding-top: 2px;margin-bottom: 5px;" *ngIf="!habilitarAcordo" (click)="baixarPagamentos()">
          <i class="fas fa-money-bill-wave"></i> Baixar Pagamentos
        </button>
        <button type="button" class="btn btn-success btn-sm me-1" style="padding-bottom: 2px;padding-top: 2px;margin-bottom: 5px;" *ngIf="habilitarAcordo">
          <i class="fas fa-handshake"></i> Salvar Acordo
        </button>
        <button type="button" class="btn btn-danger btn-sm" style="padding-bottom: 2px;padding-top: 2px;margin-bottom: 5px;" (click)="fechaModal()">
          <i class="fas fa-window-close"></i> Cancelar
        </button>
      </div>
    </form>
  </div>
</ng-template>
